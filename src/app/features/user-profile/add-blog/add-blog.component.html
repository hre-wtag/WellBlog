<div
  class="add-blog-container container bg-light border rounded d-grid justify-content-center"
>
  <form class="my-5" [formGroup]="blogForm" (ngSubmit)="onSubmit()">
    <div class="d-flex align-items-center justify-content-center mb-5">
      <div class="me-4">
        <label class="form-label">Title</label>
        <input
          type="text"
          class="form-control form-input"
          formControlName="title"
          (blur)="removeWhiteSpaces($event)"
          [ngClass]="{
            'border-danger':
              !blogForm.get('title')?.valid && blogForm.get('title')?.touched
          }"
        />
        @if (!blogForm.get('title')?.valid && blogForm.get('title')?.touched){
        @if(blogForm.get('title')?.errors?.['maxlength']){
        <div class="text-danger">Title cannot exceed 250 characters.</div>
        } @else {
        <div class="text-danger">This field is required.</div>
        } }
      </div>
      <div class="ms-4">
        <label class="form-label">Tags</label>
        <div class="dropdown d-flex">
          @if(!hasTag){
          <span
            class="dropdown-toggle form-control form-input select-tag d-flex align-items-center"
            (click)="checkDropdown(!showDropdown)"
          >
            Select at least one tag </span
          >} @else{
          <span class="form-control form-input d-flex align-items-center p-0"
            >@for(selectedTag of selectedTags.slice(0, 4); track selectedTag ; )
            {
            <span class="selected-tag position-relative border m-1 p-1">
              {{
                selectedTag.length > 10
                  ? selectedTag.substring(0, 10) + "..."
                  : selectedTag
              }}
              <div
                class="cross-btn position-absolute top-0 start-100 translate-middle"
                (click)="
                  onCheckboxClick(selectedTag, false); checkDropdown(false)
                "
              >
                <i class="bi bi-x-circle-fill text-danger"></i>
              </div> </span
            >} @if(selectedTags.length>4){
            <span class="add-more color-primary" (click)="checkDropdown(true)"
              >show more...&nbsp;
            </span>
            } @if(!showDropdown && tagList.length!==selectedTags.length &&
            selectedTags.length<=4){
            <span class="add-more color-primary" (click)="checkDropdown(true)"
              >click to add more</span
            >
            } </span
          >}
          <div
            class="dropdown-menu"
            (mouseleave)="checkDropdown(false)"
            [ngClass]="{ show: showDropdown }"
          >
            @for(tag of tagList; track tag; let i= $index){

            <div class="blog-tags form-check-wrapper">
              <div
                class="form-check ms-2"
                (click)="onCheckboxClick(tag.title, !tag.isChecked)"
                (dblclick)="onCheckboxDoubleClick(tag.title, !tag.isChecked)"
              >
                <input
                  class="form-check-input form-input"
                  type="checkbox"
                  [value]="tag.title"
                  [id]="'tagCheckbox' + i"
                  [checked]="tag.isChecked"
                />
                <label class="form-check-label my-1">
                  {{
                    tag.title.length > 15
                      ? tag.title.substring(0, 15) + "..."
                      : tag.title
                  }}
                </label>
              </div>
            </div>
            }
          </div>
        </div>

        @if (!blogForm.get('tags')?.valid && blogForm.get('tags')?.touched){
        <div class="text-danger">tags error</div>
        }
      </div>
    </div>
    <div class="d-grid justify-content-center my-5">
      <label class="form-label">Banner Image</label>
      @if(!isEditing){
      <div
        class="banner-image d-flex align-items-center justify-content-center"
        (drop)="dropHandler($event)"
        (dragover)="dragOver($event)"
      >
        <input
          class="form-control form-input"
          id="fileUpload"
          class="form-control form-input d-none"
          accept="image/jpeg,image/jpg,image/png"
          type="file"
          (change)="handleImageFileChange($event)"
        />
        <h5>Drop your image here, or &nbsp;</h5>
        <label class="image-label" for="fileUpload"
          ><h5 class="color-primary">browse</h5></label
        >
      </div>
      } @else{
      <div class="editing-image d-flex align-items-center">
        <div
          class="banner-image d-flex align-items-center justify-content-center"
          (drop)="dropHandler($event)"
          (dragover)="dragOver($event)"
        >
          <input
            class="form-control form-input"
            id="fileUpload"
            class="form-control form-input d-none"
            accept="image/jpeg,image/jpg,image/png"
            type="file"
            (change)="handleImageFileChange($event)"
          />
          <h5>Drop your image here, or &nbsp;</h5>
          <label class="image-label" for="fileUpload"
            ><h5 class="color-primary">browse</h5></label
          >
        </div>
        <img
          class="blog-image border ms-3"
          [src]="uploadedImage ? uploadedImage : editedBlog.blogImage"
          [alt]="editedBlog.title"
        />
      </div>
      }
    </div>
    <div class="text-center my-5">
      <span
        class="form-control uploaded-file d-grid align-items-center bg-light text-muted"
        >Uploaded File:{{
          uploadedImageName ? uploadedImageName : "No file Uploaded."
        }}
      </span>
    </div>
    <div class="my-5">
      <label class="form-label">Blog Body</label>
      <editor
        class="form-control blog-description py-1"
        formControlName="description"
        [ngClass]="{
          'border-danger':
            !blogForm.get('description')?.valid &&
            blogForm.get('description')?.touched
        }"
        [init]="init"
        [apiKey]="tinyAPIKey"
      ></editor>
      @if (!blogForm.get('description')?.valid &&
      blogForm.get('description')?.touched){
      <div class="text-danger">This field is required.</div>
      }
    </div>

    <div class="d-flex align-items-center justify-content-center">
      <button
        class="btn btn-submit me-1"
        type="submit"
        [disabled]="blogForm.invalid"
      >
        Submit
      </button>
      <button
        class="btn btn-cancel bg-light text-muted ms-1"
        type="button"
        (click)="onCancel()"
      >
        Cancel
      </button>
    </div>
  </form>
</div>
